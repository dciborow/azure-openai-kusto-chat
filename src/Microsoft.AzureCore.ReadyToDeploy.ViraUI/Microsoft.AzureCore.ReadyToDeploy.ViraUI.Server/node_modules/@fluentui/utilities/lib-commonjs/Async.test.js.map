{"version":3,"file":"Async.test.js","sourceRoot":"../src/","sources":["Async.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { Async } from './Async';\nimport type { ICancelable } from './Async';\n\ndescribe('Async', () => {\n  describe('debounce', () => {\n    // Increase count by a specific number, to test the arguments\n    // of the debounced function;\n    let callCount = 0;\n    const fnMock = (increaseCount: number) => {\n      callCount += increaseCount;\n      return callCount;\n    };\n    let fn: jest.Mock<number, [increaseCount: number], unknown>;\n    let async: Async;\n    let debouncedFn: ICancelable<typeof fn> & typeof fn;\n\n    beforeEach(() => {\n      jest.useFakeTimers();\n      fn = jest.fn(fnMock);\n      async = new Async();\n      debouncedFn = async.debounce(fn, 100);\n    });\n\n    afterEach(() => {\n      callCount = 0;\n      fn.mockClear();\n    });\n\n    it('should debounce multiple calls', () => {\n      // Mock Date.now to return each call\n      // First one is the first debouncedFn(1)\n      // Second one is debouncedFn(2)\n      // A last one will be when the timer fires after we run pending timers in jest.\n      const dateMock = jest\n        .spyOn(Date, 'now')\n        .mockImplementationOnce(() => 10)\n        .mockImplementationOnce(() => 11)\n        .mockImplementation(() => 2000);\n\n      debouncedFn(1);\n      expect(debouncedFn.pending()).toBeTruthy();\n      debouncedFn(2);\n      expect(debouncedFn.pending()).toBeTruthy();\n\n      jest.runOnlyPendingTimers();\n\n      expect(fn).toHaveBeenCalledTimes(1);\n      expect(callCount).toEqual(2);\n\n      dateMock.mockRestore();\n    });\n\n    it('should flush the last value', () => {\n      debouncedFn(10);\n      debouncedFn(20);\n      expect(debouncedFn.pending()).toBeTruthy();\n      expect(debouncedFn.flush()).toEqual(20);\n    });\n\n    it('should be marked pending as expected', () => {\n      debouncedFn(100);\n      expect(debouncedFn.pending()).toBeTruthy();\n      debouncedFn(200);\n      expect(debouncedFn.pending()).toBeTruthy();\n\n      debouncedFn.flush();\n      expect(debouncedFn.pending()).toBeFalsy();\n    });\n\n    it('should be cancellable', () => {\n      debouncedFn(1000);\n      debouncedFn.cancel();\n      expect(debouncedFn.pending()).toBeFalsy();\n      expect(debouncedFn.flush()).toBeUndefined();\n    });\n  });\n\n  describe('throttle', () => {\n    it('should throttle multiple calls', () => {\n      jest.useFakeTimers();\n\n      // Mock Date.now to return each call\n      // First one is the first throttledFn(1)\n      // Second one is throttledFn(2)\n      // A last one will be when the timer fires after we run pending timers in jest.\n      const dateMock = jest\n        .spyOn(Date, 'now')\n        .mockImplementationOnce(() => 10)\n        .mockImplementationOnce(() => 11)\n        .mockImplementation(() => 2000);\n\n      const fn = jest.fn((num: number) => num);\n      const async = new Async();\n      const throttledFn = async.throttle(fn, 1000);\n\n      let result = throttledFn(1);\n      expect(result).toBeUndefined();\n      result = throttledFn(2);\n      expect(result).toBeUndefined();\n\n      jest.runOnlyPendingTimers();\n\n      expect(fn).toHaveBeenCalledTimes(1);\n\n      dateMock.mockRestore();\n      jest.useRealTimers();\n    });\n  });\n});\n"]}