{"version":3,"file":"MergeStylesRootContext.js","sourceRoot":"../src/","sources":["shadowDom/contexts/MergeStylesRootContext.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  GLOBAL_STYLESHEET_KEY,\n  ShadowDomStylesheet,\n  makeShadowConfig,\n  DEFAULT_SHADOW_CONFIG,\n} from '@fluentui/merge-styles';\nimport { getWindow } from '../../dom';\n\nimport {\n  useAdoptedStylesheet as useAdoptedStylesheetDefault,\n  useAdoptedStylesheetEx as useAdoptedStylesheetExDefault,\n} from '../hooks/useAdoptedStylesheet';\nimport { useShadowConfig as useShadowConfigDefault } from '../hooks/useShadowConfig';\nimport {\n  useHasMergeStylesShadowRootContext as useHasMergeStylesShadowRootContextDefault,\n  useMergeStylesShadowRootContext as useMergeStylesShadowRootContextDefault,\n} from '../hooks/useMergeStylesShadowRoot';\nimport { useMergeStylesRootStylesheets as useMergeStylesRootStylesheetsDefault } from '../hooks/useMergeStylesRootStylesheets';\nimport { useStyled as useStyledDefault } from '../hooks/useStyled';\nimport { useWindow as useWindowDefault } from '@fluentui/react-window-provider';\n\nimport type { ExtendedCSSStyleSheet } from '@fluentui/merge-styles';\nimport type { AdoptedStylesheetExHook, AdoptedStylesheetHook } from '../hooks/useAdoptedStylesheet';\nimport type { ShadowConfigHook } from '../hooks/useShadowConfig';\nimport type {\n  HasMergeStylesShadowRootContextHook,\n  MergeStylesShadowRootContetHook,\n} from '../hooks/useMergeStylesShadowRoot';\nimport type { MergeStylesRootStylesheetsHook } from '../hooks/useMergeStylesRootStylesheets';\nimport type { UseStyledHook } from '../hooks/useStyled';\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  interface DocumentOrShadowRoot {\n    /** [MDN Reference](https://developer.mozilla.org/docs/Web/API/Document/adoptedStyleSheets) */\n    adoptedStyleSheets: CSSStyleSheet[];\n  }\n}\n\ntype UseWindowHook = () => Window | undefined;\n\nconst noop = () => false;\nconst noopShadow = () => DEFAULT_SHADOW_CONFIG;\nconst noopRootStylesheets = () => new Map();\nconst noopUndefined = () => undefined;\n\nexport type MergeStylesRootContextValue = {\n  /**\n   * Map of stylesheets available in the context.\n   */\n  stylesheets: Map<string, ExtendedCSSStyleSheet>;\n  useAdoptedStylesheetEx: AdoptedStylesheetExHook;\n  useAdoptedStylesheet: AdoptedStylesheetHook;\n  useShadowConfig: ShadowConfigHook;\n  useMergeStylesShadowRootContext: MergeStylesShadowRootContetHook;\n  useHasMergeStylesShadowRootContext: HasMergeStylesShadowRootContextHook;\n  useMergeStylesRootStylesheets: MergeStylesRootStylesheetsHook;\n  useWindow: UseWindowHook;\n  useStyled: UseStyledHook;\n};\n\nexport const MergeStylesRootContext = React.createContext<MergeStylesRootContextValue>({\n  stylesheets: new Map(),\n  useAdoptedStylesheetEx: noop,\n  useAdoptedStylesheet: noop,\n  useShadowConfig: noopShadow,\n  useMergeStylesShadowRootContext: noopUndefined,\n  useHasMergeStylesShadowRootContext: noop,\n  useMergeStylesRootStylesheets: noopRootStylesheets,\n  useWindow: noopUndefined,\n  useStyled: noopUndefined,\n});\n\nexport type MergeStylesRootProviderProps = {\n  /**\n   * Map of stylesheets available in the context.\n   */\n  stylesheets?: Map<string, ExtendedCSSStyleSheet>;\n\n  /**\n   * Optional `window` object to use for reading adopted stylesheets.\n   * Useful for multi-window scenarios.\n   */\n  window?: Window;\n\n  useAdoptedStylesheetEx?: AdoptedStylesheetExHook;\n  useAdoptedStylesheet?: AdoptedStylesheetHook;\n  useShadowConfig?: ShadowConfigHook;\n  useMergeStylesShadowRootContext?: MergeStylesShadowRootContetHook;\n  useHasMergeStylesShadowRootContext?: HasMergeStylesShadowRootContextHook;\n  useMergeStylesRootStylesheets?: MergeStylesRootStylesheetsHook;\n  useWindow?: UseWindowHook;\n  useStyled?: UseStyledHook;\n};\n\n/**\n * Root context provider for mergeStyles shadow DOM.\n * Typically this is placed at the render root of your React application.\n */\nexport const MergeStylesRootProvider: React.FC<MergeStylesRootProviderProps> = ({\n  stylesheets: userSheets,\n  window: userWindow,\n  useAdoptedStylesheet,\n  useAdoptedStylesheetEx,\n  useShadowConfig,\n  useMergeStylesShadowRootContext,\n  useHasMergeStylesShadowRootContext,\n  useMergeStylesRootStylesheets,\n  useWindow,\n  useStyled,\n  ...props\n}) => {\n  const win = userWindow ?? getWindow();\n  const [stylesheets, setStylesheets] = React.useState<Map<string, ExtendedCSSStyleSheet>>(\n    () => userSheets || new Map(),\n  );\n\n  const sheetHandler = React.useCallback(({ key, sheet }) => {\n    setStylesheets(prev => {\n      const next = new Map<string, ExtendedCSSStyleSheet>(prev);\n      next.set(key, sheet);\n      return next;\n    });\n  }, []);\n\n  // Udapte stylesheets based on user style sheet changes\n  React.useEffect(() => {\n    setStylesheets(userSheets || new Map());\n  }, [userSheets]);\n\n  // Wire up listener for adopted stylesheets\n  React.useEffect(() => {\n    if (!win) {\n      return;\n    }\n\n    const sheet = ShadowDomStylesheet.getInstance(makeShadowConfig(GLOBAL_STYLESHEET_KEY, false, win));\n    const off = sheet.onAddSheet(sheetHandler);\n\n    return () => {\n      off();\n    };\n  }, [win, sheetHandler]);\n\n  // Read stylesheets from window on mount\n  React.useEffect(() => {\n    if (!win) {\n      return;\n    }\n\n    let changed = false;\n    const next = new Map<string, ExtendedCSSStyleSheet>(stylesheets);\n    const sheet = ShadowDomStylesheet.getInstance(makeShadowConfig(GLOBAL_STYLESHEET_KEY, false, win));\n\n    const adoptedSheets = sheet.getAdoptedSheets();\n\n    adoptedSheets.forEach((adoptedSheet, key) => {\n      next.set(key, adoptedSheet);\n      changed = true;\n    });\n\n    if (changed) {\n      setStylesheets(next);\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const value = React.useMemo(() => {\n    return {\n      stylesheets,\n      useAdoptedStylesheet: useAdoptedStylesheet || useAdoptedStylesheetDefault,\n      useAdoptedStylesheetEx: useAdoptedStylesheetEx || useAdoptedStylesheetExDefault,\n      useShadowConfig: useShadowConfig || useShadowConfigDefault,\n      useMergeStylesShadowRootContext: useMergeStylesShadowRootContext || useMergeStylesShadowRootContextDefault,\n      useHasMergeStylesShadowRootContext:\n        useHasMergeStylesShadowRootContext || useHasMergeStylesShadowRootContextDefault,\n      useMergeStylesRootStylesheets: useMergeStylesRootStylesheets || useMergeStylesRootStylesheetsDefault,\n      useWindow: useWindow || useWindowDefault,\n      useStyled: useStyled || useStyledDefault,\n    };\n  }, [\n    stylesheets,\n    useAdoptedStylesheet,\n    useAdoptedStylesheetEx,\n    useShadowConfig,\n    useMergeStylesShadowRootContext,\n    useHasMergeStylesShadowRootContext,\n    useMergeStylesRootStylesheets,\n    useWindow,\n    useStyled,\n  ]);\n\n  return <MergeStylesRootContext.Provider value={value} {...props} />;\n};\n"]}