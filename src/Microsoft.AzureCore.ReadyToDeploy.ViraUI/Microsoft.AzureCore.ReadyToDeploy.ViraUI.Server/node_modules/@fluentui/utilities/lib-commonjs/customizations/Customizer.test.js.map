{"version":3,"file":"Customizer.test.js","sourceRoot":"../src/","sources":["customizations/Customizer.test.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable deprecation/deprecation */\nimport * as React from 'react';\nimport { customizable } from './customizable';\nimport { Customizer } from './Customizer';\nimport { Customizations } from './Customizations';\nimport { safeMount } from '@fluentui/test-utilities';\n\n@customizable('Foo', ['field'])\nclass Foo extends React.Component<{ field?: string }, {}> {\n  public render(): JSX.Element {\n    return <div>{this.props.field}</div>;\n  }\n}\n\n@customizable('Bar', ['field', 'field2', 'field3'])\nclass Bar extends React.Component<{ field?: string; field2?: string; field3?: string }, {}> {\n  public render(): JSX.Element {\n    return (\n      <div>\n        {this.props.field}\n        {this.props.field2}\n        {this.props.field3}\n      </div>\n    );\n  }\n}\n\ndescribe('Customizer', () => {\n  beforeEach(() => {\n    Customizations.reset();\n  });\n\n  it('can provide new defaults', () => {\n    safeMount(\n      <Customizer settings={{ field: 'customName' }}>\n        <Foo />\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>customName</div>');\n      },\n    );\n  });\n\n  it('can pass through global settings', () => {\n    Customizations.applySettings({ field: 'globalName' });\n\n    safeMount(\n      <Customizer settings={{ nonMatch: 'customName' }}>\n        <Foo />\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>globalName</div>');\n      },\n    );\n  });\n\n  it('can override global settings', () => {\n    Customizations.applySettings({ field: 'globalName' });\n\n    safeMount(\n      <Customizer settings={{ field: 'customName' }}>\n        <Foo />\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>customName</div>');\n      },\n    );\n  });\n\n  it('can scope settings to specific components', () => {\n    const scopedSettings = {\n      Foo: { field: 'scopedToFoo' },\n      Bar: { field: 'scopedToBar' },\n    };\n\n    safeMount(\n      <Customizer scopedSettings={scopedSettings}>\n        <div>\n          <Foo />\n          <Bar />\n        </div>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div><div>scopedToFoo</div><div>scopedToBar</div></div>');\n      },\n    );\n  });\n\n  it('can layer global settings', () => {\n    safeMount(\n      <Customizer settings={{ field: 'field' }}>\n        <Customizer settings={{ field2: 'field2' }}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>fieldfield2</div>');\n      },\n    );\n  });\n\n  it('can layer scoped settings', () => {\n    Customizations.applySettings({ field3: 'field3' });\n\n    safeMount(\n      <Customizer scopedSettings={{ Bar: { field: 'field', field2: 'oldfield2' } }}>\n        <Customizer scopedSettings={{ Bar: { field2: 'field2' } }}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>fieldfield2field3</div>');\n      },\n    );\n  });\n\n  it('can layer scoped settings with scopedSettingsFunction', () => {\n    Customizations.applySettings({ field3: 'field3' });\n\n    safeMount(\n      <Customizer scopedSettings={{ Bar: { field: 'field' } }}>\n        <Customizer\n          scopedSettings={(scopedSettings: { Bar: { field2: string } }) => ({\n            Bar: { ...scopedSettings.Bar, field2: 'field2' },\n          })}\n        >\n          <Bar />\n        </Customizer>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>fieldfield2field3</div>');\n      },\n    );\n  });\n\n  it('it allows scopedSettings to be merged when a function is passed', () => {\n    safeMount(\n      <Customizer scopedSettings={{ Foo: { field: 'scopedToFoo' } }}>\n        <Customizer\n          scopedSettings={(settings: { Foo: { field: string } }) => ({ ...settings, Bar: { field: 'scopedToBar' } })}\n        >\n          <div>\n            <Foo />\n            <Bar />\n          </div>\n        </Customizer>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div><div>scopedToFoo</div><div>scopedToBar</div></div>');\n      },\n    );\n  });\n\n  it('overrides previously set settings', () => {\n    safeMount(\n      <Customizer settings={{ field: 'field1' }}>\n        <Customizer settings={{ field: 'field2' }}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>field2</div>');\n      },\n    );\n  });\n\n  it('overrides the old settings when the parameter is ignored', () => {\n    safeMount(\n      <Customizer settings={{ field: 'field1' }}>\n        <Customizer settings={(settings: { field: string }) => ({ field: 'field2' })}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>field2</div>');\n      },\n    );\n  });\n\n  it('can use a function to merge settings', () => {\n    safeMount(\n      <Customizer settings={{ field: 'field1' }}>\n        <Customizer settings={(settings: { field: string }) => ({ field: settings.field + 'field2' })}>\n          <Bar />\n        </Customizer>\n      </Customizer>,\n      wrapper => {\n        expect(wrapper.html()).toEqual('<div>field1field2</div>');\n      },\n    );\n  });\n\n  it('can suppress updates', () => {\n    Customizations.applySettings({ field: 'globalName' });\n\n    safeMount(\n      <Customizer settings={{ nonMatch: 'customName' }}>\n        <Bar />\n      </Customizer>,\n      wrapper => {\n        // verify base state\n        expect(wrapper.html()).toEqual('<div>globalName</div>');\n\n        // verify it doesn't update during suppressUpdates(), and it works through errors, and it updates after\n        Customizations.applyBatchedUpdates(() => {\n          Customizations.applySettings({ field: 'notGlobalName' });\n          // it should not update inside\n          expect(wrapper.html()).toEqual('<div>globalName</div>');\n          throw new Error();\n        });\n        // afterwards it should have updated\n        expect(wrapper.html()).toEqual('<div>notGlobalName</div>');\n\n        // verify it doesn't update during suppressUpdates(), works through errors, and can suppress final update\n        Customizations.applyBatchedUpdates(() => {\n          Customizations.applySettings({ field: 'notUpdated' });\n          // it should not update inside\n          expect(wrapper.html()).toEqual('<div>notGlobalName</div>');\n          throw new Error();\n        }, true);\n        // afterwards, it should still be on the old value\n        expect(wrapper.html()).toEqual('<div>notGlobalName</div>');\n\n        // verify it updates after suppressUpdates()\n        Customizations.applySettings({ field2: 'lastGlobalName' });\n        expect(wrapper.html()).toEqual('<div>notUpdatedlastGlobalName</div>');\n      },\n    );\n  });\n});\n"]}