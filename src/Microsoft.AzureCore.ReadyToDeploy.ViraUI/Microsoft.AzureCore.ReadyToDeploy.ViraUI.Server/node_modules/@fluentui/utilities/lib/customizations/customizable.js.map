{"version":3,"file":"customizable.js","sourceRoot":"../src/","sources":["customizations/customizable.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Customizations } from './Customizations';\nimport { hoistStatics } from '../hoistStatics';\nimport { CustomizerContext } from './CustomizerContext';\nimport { concatStyleSets, makeShadowConfig } from '@fluentui/merge-styles';\nimport { MergeStylesShadowRootConsumer } from '../shadowDom/contexts/MergeStylesShadowRootConsumer';\nimport { getWindow } from '../dom/getWindow';\nimport { WindowContext } from '@fluentui/react-window-provider';\nimport type { ICustomizerContext } from './CustomizerContext';\nimport type { ShadowConfig } from '@fluentui/merge-styles';\n\nimport { memoizeFunction } from '../memoize';\n\nconst memoizedMakeShadowConfig = memoizeFunction(makeShadowConfig);\nconst mergeComponentStyles = memoizeFunction(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (defaultStyles: any, componentStyles: any, shadowConfig: ShadowConfig): any => {\n    return {\n      ...defaultStyles,\n      ...componentStyles,\n      __shadowConfig__: shadowConfig,\n    };\n  },\n);\n\nexport function customizable(\n  scope: string,\n  fields: string[],\n  concatStyles?: boolean,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): <P>(ComposedComponent: React.ComponentType<P>) => any {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return function customizableFactory<P>(ComposedComponent: React.ComponentType<P>): any {\n    const resultClass = class ComponentWithInjectedProps extends React.Component<P, {}> {\n      public static displayName: string = 'Customized' + scope;\n      public static contextType = WindowContext;\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      private _styleCache: { default?: any; component?: any; merged?: any } = {};\n\n      constructor(props: P) {\n        super(props);\n\n        this._onSettingChanged = this._onSettingChanged.bind(this);\n      }\n\n      public componentDidMount(): void {\n        Customizations.observe(this._onSettingChanged);\n      }\n\n      public componentWillUnmount(): void {\n        Customizations.unobserve(this._onSettingChanged);\n      }\n\n      public render(): JSX.Element {\n        return (\n          <MergeStylesShadowRootConsumer stylesheetKey={scope}>\n            {(inShadow: boolean) => {\n              return (\n                <CustomizerContext.Consumer>\n                  {(context: ICustomizerContext) => {\n                    const defaultProps = Customizations.getSettings(fields, scope, context.customizations);\n\n                    const win = this.context.window ?? getWindow();\n                    const shadowConfig = memoizedMakeShadowConfig(scope, inShadow, win);\n\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    const componentProps = this.props as any;\n\n                    // If defaultProps.styles is a function, evaluate it before calling concatStyleSets\n                    if (defaultProps.styles && typeof defaultProps.styles === 'function') {\n                      defaultProps.styles = defaultProps.styles({ ...defaultProps, ...componentProps });\n                    }\n\n                    // If concatStyles is true and custom styles have been defined compute those styles\n                    if (concatStyles && defaultProps.styles) {\n                      if (\n                        this._styleCache.default !== defaultProps.styles ||\n                        this._styleCache.component !== componentProps.styles\n                      ) {\n                        const mergedStyles = concatStyleSets(defaultProps.styles, componentProps.styles);\n                        mergedStyles.__shadowConfig__ = shadowConfig;\n                        this._styleCache.default = defaultProps.styles;\n                        this._styleCache.component = componentProps.styles;\n                        this._styleCache.merged = mergedStyles;\n                      }\n\n                      return (\n                        <ComposedComponent {...defaultProps} {...componentProps} styles={this._styleCache.merged} />\n                      );\n                    }\n\n                    const styles = mergeComponentStyles(defaultProps.styles, componentProps.styles, shadowConfig);\n\n                    return <ComposedComponent {...defaultProps} {...componentProps} styles={styles} />;\n                  }}\n                </CustomizerContext.Consumer>\n              );\n            }}\n          </MergeStylesShadowRootConsumer>\n        );\n      }\n\n      private _onSettingChanged(): void {\n        this.forceUpdate();\n      }\n    };\n\n    return hoistStatics(ComposedComponent, resultClass);\n  };\n}\n"]}