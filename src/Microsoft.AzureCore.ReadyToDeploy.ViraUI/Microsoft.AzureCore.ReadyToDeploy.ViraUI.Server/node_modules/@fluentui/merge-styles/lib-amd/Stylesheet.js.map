{"version":3,"file":"Stylesheet.js","sourceRoot":"../src/","sources":["Stylesheet.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint no-restricted-globals: 0 */\n// globals in stylesheets will be addressed as part of shadow DOM work.\n// See: https://github.com/microsoft/fluentui/issues/28058\nimport { IStyle } from './IStyle';\nimport { GLOBAL_STYLESHEET_KEY, SHADOW_DOM_STYLESHEET_SETTING } from './shadowConfig';\nimport type { ShadowConfig } from './shadowConfig';\n\nexport const InjectionMode = {\n  /**\n   * Avoids style injection, use getRules() to read the styles.\n   */\n  none: 0 as 0,\n\n  /**\n   * Inserts rules using the insertRule api.\n   */\n  insertNode: 1 as 1,\n\n  /**\n   * Appends rules using appendChild.\n   */\n  appendChild: 2 as 2,\n};\n\nexport type InjectionMode = (typeof InjectionMode)[keyof typeof InjectionMode];\n\n/**\n * CSP settings for the stylesheet\n */\nexport interface ICSPSettings {\n  /**\n   * Nonce to inject into script tag\n   */\n  nonce?: string;\n}\n\n/**\n * Stylesheet config.\n *\n * @public\n */\nexport interface IStyleSheetConfig {\n  /**\n   * Injection mode for how rules are inserted.\n   */\n  injectionMode?: InjectionMode;\n\n  /**\n   * Default 'displayName' to use for a className.\n   * @defaultvalue 'css'\n   */\n  defaultPrefix?: string;\n\n  /**\n   * Defines the default direction of rules for auto-rtlifying things.\n   * While typically this is represented as a DIR attribute in the markup,\n   * the DIR is not enough to control whether padding goes on the left or\n   * right. Use this to set the default direction when rules are registered.\n   */\n  rtl?: boolean;\n\n  /**\n   * Default 'namespace' to attach before the className.\n   */\n  namespace?: string;\n\n  /**\n   * CSP settings\n   */\n  cspSettings?: ICSPSettings;\n\n  /**\n   * Callback executed when a rule is inserted.\n   * @deprecated Use `Stylesheet.onInsertRule` instead.\n   */\n  onInsertRule?: (rule: string) => void;\n\n  /**\n   * Initial value for classnames cache. Key is serialized css rules associated with a classname.\n   */\n  classNameCache?: { [key: string]: string };\n\n  window?: Window;\n\n  inShadow?: boolean;\n\n  stylesheetKey?: string;\n}\n\n/**\n * Representation of Stylesheet used for rehydration.\n */\nexport interface ISerializedStylesheet {\n  classNameToArgs: Stylesheet['_classNameToArgs'];\n  counter: Stylesheet['_counter'];\n  keyToClassName: Stylesheet['_keyToClassName'];\n  preservedRules: Stylesheet['_preservedRules'];\n  rules: Stylesheet['_rules'];\n}\n\nexport const STYLESHEET_SETTING = '__stylesheet__';\n\n/**\n * MSIE 11 doesn't cascade styles based on DOM ordering, but rather on the order that each style node\n * is created. As such, to maintain consistent priority, IE11 should reuse a single style node.\n */\nconst REUSE_STYLE_NODE = typeof navigator !== 'undefined' && /rv:11.0/.test(navigator.userAgent);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  interface Document {\n    adoptedStyleSheets: CSSStyleSheet[];\n  }\n}\n\nexport type WindowWithMergeStyles = (Window | {}) & {\n  [STYLESHEET_SETTING]?: Stylesheet;\n  [SHADOW_DOM_STYLESHEET_SETTING]?: typeof Stylesheet;\n  FabricConfig?: {\n    mergeStyles?: IStyleSheetConfig;\n    serializedStylesheet?: ISerializedStylesheet;\n  };\n};\n\nlet _global: WindowWithMergeStyles = {};\n\n// Grab window.\ntry {\n  // Why the cast?\n  // if compiled/type checked in same program with `@fluentui/font-icons-mdl2` which extends `Window` on global\n  // ( check packages/font-icons-mdl2/src/index.ts ) the definitions don't match! Thus the need of this extra assertion\n  _global = (window || {}) as WindowWithMergeStyles;\n} catch {\n  /* leave as blank object */\n}\n\nlet _stylesheet: Stylesheet | undefined;\n\nexport type ExtendedCSSStyleSheet = CSSStyleSheet & {\n  bucketName: string;\n  metadata: Record<string, unknown>;\n};\n\ntype InsertRuleArgs = {\n  key?: string;\n  sheet?: ExtendedCSSStyleSheet | null;\n  rule?: string;\n};\n\nexport type InsertRuleCallback = ({ key, sheet, rule }: InsertRuleArgs) => void;\n\n/**\n * Represents the state of styles registered in the page. Abstracts\n * the surface for adding styles to the stylesheet, exposes helpers\n * for reading the styles registered in server rendered scenarios.\n *\n * @public\n */\nexport class Stylesheet {\n  protected _lastStyleElement?: HTMLStyleElement;\n  protected _config: IStyleSheetConfig;\n\n  private _styleElement?: HTMLStyleElement;\n\n  private _rules: string[] = [];\n  private _preservedRules: string[] = [];\n  private _counter = 0;\n  private _keyToClassName: { [key: string]: string } = {};\n  private _onInsertRuleCallbacks: (Function | InsertRuleCallback)[] = [];\n  private _onResetCallbacks: Function[] = [];\n  private _classNameToArgs: { [key: string]: { args: any; rules: string[] } } = {};\n\n  /**\n   * Gets the singleton instance.\n   */\n  public static getInstance(shadowConfig?: ShadowConfig): Stylesheet {\n    _stylesheet = _global[STYLESHEET_SETTING] as Stylesheet;\n\n    if (_global[SHADOW_DOM_STYLESHEET_SETTING]) {\n      return _global[SHADOW_DOM_STYLESHEET_SETTING].getInstance(shadowConfig);\n    }\n\n    if (!_stylesheet || (_stylesheet._lastStyleElement && _stylesheet._lastStyleElement.ownerDocument !== document)) {\n      const fabricConfig = _global?.FabricConfig || {};\n\n      const stylesheet = new Stylesheet(fabricConfig.mergeStyles, fabricConfig.serializedStylesheet);\n      _stylesheet = stylesheet;\n      _global[STYLESHEET_SETTING] = stylesheet;\n    }\n\n    return _stylesheet;\n  }\n\n  constructor(config?: IStyleSheetConfig, serializedStylesheet?: ISerializedStylesheet) {\n    // If there is no document we won't have an element to inject into.\n    this._config = {\n      injectionMode: typeof document === 'undefined' ? InjectionMode.none : InjectionMode.insertNode,\n      defaultPrefix: 'css',\n      namespace: undefined,\n      cspSettings: undefined,\n      ...config,\n    };\n\n    this._classNameToArgs = serializedStylesheet?.classNameToArgs ?? this._classNameToArgs;\n    this._counter = serializedStylesheet?.counter ?? this._counter;\n    this._keyToClassName = this._config.classNameCache ?? serializedStylesheet?.keyToClassName ?? this._keyToClassName;\n    this._preservedRules = serializedStylesheet?.preservedRules ?? this._preservedRules;\n    this._rules = serializedStylesheet?.rules ?? this._rules;\n  }\n\n  /**\n   * Serializes the Stylesheet instance into a format which allows rehydration on creation.\n   * @returns string representation of `ISerializedStylesheet` interface.\n   */\n  public serialize(): string {\n    return JSON.stringify({\n      classNameToArgs: this._classNameToArgs,\n      counter: this._counter,\n      keyToClassName: this._keyToClassName,\n      preservedRules: this._preservedRules,\n      rules: this._rules,\n    });\n  }\n\n  /**\n   * Configures the stylesheet.\n   */\n  public setConfig(config?: IStyleSheetConfig): void {\n    this._config = {\n      ...this._config,\n      ...config,\n    };\n  }\n\n  /**\n   * Configures a reset callback.\n   *\n   * @param callback - A callback which will be called when the Stylesheet is reset.\n   * @returns function which when called un-registers provided callback.\n   */\n  public onReset(callback: Function): Function {\n    this._onResetCallbacks.push(callback);\n\n    return () => {\n      this._onResetCallbacks = this._onResetCallbacks.filter(cb => cb !== callback);\n    };\n  }\n\n  /**\n   * Configures an insert rule callback.\n   *\n   * @param callback - A callback which will be called when a rule is inserted.\n   * @returns function which when called un-registers provided callback.\n   */\n  public onInsertRule(callback: Function | InsertRuleCallback): Function {\n    this._onInsertRuleCallbacks.push(callback);\n\n    return () => {\n      this._onInsertRuleCallbacks = this._onInsertRuleCallbacks.filter(cb => cb !== callback);\n    };\n  }\n\n  /**\n   * Generates a unique classname.\n   *\n   * @param displayName - Optional value to use as a prefix.\n   */\n  public getClassName(displayName?: string): string {\n    const { namespace } = this._config;\n    const prefix = displayName || this._config.defaultPrefix;\n\n    return `${namespace ? namespace + '-' : ''}${prefix}-${this._counter++}`;\n  }\n\n  /**\n   * Used internally to cache information about a class which was\n   * registered with the stylesheet.\n   */\n  public cacheClassName(className: string, key: string, args: IStyle[], rules: string[]): void {\n    this._keyToClassName[this._getCacheKey(key)] = className;\n    this._classNameToArgs[className] = {\n      args,\n      rules,\n    };\n  }\n\n  /**\n   * Gets the appropriate classname given a key which was previously\n   * registered using cacheClassName.\n   */\n  public classNameFromKey(key: string): string | undefined {\n    return this._keyToClassName[this._getCacheKey(key)];\n  }\n\n  /**\n   * Gets all classnames cache with the stylesheet.\n   */\n  public getClassNameCache(): { [key: string]: string } {\n    return this._keyToClassName;\n  }\n\n  /**\n   * Gets the arguments associated with a given classname which was\n   * previously registered using cacheClassName.\n   */\n  public argsFromClassName(className: string): IStyle[] | undefined {\n    const entry = this._classNameToArgs[className];\n\n    return entry && entry.args;\n  }\n\n  /**\n   * Gets the rules associated with a given classname which was\n   * previously registered using cacheClassName.\n   */\n  public insertedRulesFromClassName(className: string): string[] | undefined {\n    const entry = this._classNameToArgs[className];\n\n    return entry && entry.rules;\n  }\n\n  /**\n   * Inserts a css rule into the stylesheet.\n   * @param preserve - Preserves the rule beyond a reset boundary.\n   */\n  public insertRule(rule: string, preserve?: boolean, stylesheetKey: string = GLOBAL_STYLESHEET_KEY): void {\n    const { injectionMode } = this._config;\n\n    const element: HTMLStyleElement | undefined =\n      injectionMode !== InjectionMode.none ? this._getStyleElement() : undefined;\n\n    if (preserve) {\n      this._preservedRules.push(rule);\n    }\n\n    if (element) {\n      switch (injectionMode) {\n        case InjectionMode.insertNode:\n          this._insertRuleIntoSheet(element.sheet, rule);\n          break;\n\n        case InjectionMode.appendChild:\n          (element as HTMLStyleElement).appendChild(document.createTextNode(rule));\n          break;\n      }\n    } else {\n      this._rules.push(rule);\n    }\n\n    // eslint-disable-next-line deprecation/deprecation\n    if (this._config.onInsertRule) {\n      // eslint-disable-next-line deprecation/deprecation\n      this._config.onInsertRule(rule);\n    }\n\n    this._onInsertRuleCallbacks.forEach(callback =>\n      callback({ key: stylesheetKey, sheet: (element ? element.sheet : undefined) as ExtendedCSSStyleSheet, rule }),\n    );\n  }\n\n  /**\n   * Gets all rules registered with the stylesheet; only valid when\n   * using InsertionMode.none.\n   */\n  public getRules(includePreservedRules?: boolean): string {\n    return (includePreservedRules ? this._preservedRules.join('') : '') + this._rules.join('');\n  }\n\n  /**\n   * Resets the internal state of the stylesheet. Only used in server\n   * rendered scenarios where we're using InsertionMode.none.\n   */\n  public reset(): void {\n    this._rules = [];\n    this._counter = 0;\n    this._classNameToArgs = {};\n    this._keyToClassName = {};\n\n    this._onResetCallbacks.forEach(callback => callback());\n  }\n\n  // Forces the regeneration of incoming styles without totally resetting the stylesheet.\n  public resetKeys(): void {\n    this._keyToClassName = {};\n  }\n\n  protected _createStyleElement(): HTMLStyleElement {\n    const doc = this._config.window?.document || document;\n    const head: HTMLHeadElement = doc.head;\n    const styleElement = doc.createElement('style');\n    let nodeToInsertBefore: Node | null = null;\n\n    styleElement.setAttribute('data-merge-styles', 'true');\n\n    const { cspSettings } = this._config;\n    if (cspSettings) {\n      if (cspSettings.nonce) {\n        styleElement.setAttribute('nonce', cspSettings.nonce);\n      }\n    }\n    if (this._lastStyleElement) {\n      // If the `nextElementSibling` is null, then the insertBefore will act as a regular append.\n      // https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore#Syntax\n      nodeToInsertBefore = this._lastStyleElement.nextElementSibling;\n    } else {\n      const placeholderStyleTag: Element | null = this._findPlaceholderStyleTag();\n\n      if (placeholderStyleTag) {\n        nodeToInsertBefore = placeholderStyleTag.nextElementSibling;\n      } else {\n        nodeToInsertBefore = head.childNodes[0];\n      }\n    }\n\n    head!.insertBefore(styleElement, head!.contains(nodeToInsertBefore) ? nodeToInsertBefore : null);\n    this._lastStyleElement = styleElement;\n\n    return styleElement;\n  }\n\n  protected _insertRuleIntoSheet(sheet: CSSStyleSheet | undefined | null, rule: string): boolean {\n    if (!sheet) {\n      return false;\n    }\n\n    try {\n      sheet!.insertRule(rule, sheet!.cssRules.length);\n      return true;\n    } catch (e) {\n      // The browser will throw exceptions on unsupported rules (such as a moz prefix in webkit.)\n      // We need to swallow the exceptions for this scenario, otherwise we'd need to filter\n      // which could be slower and bulkier.\n    }\n\n    return false;\n  }\n\n  protected _getCacheKey(key: string): string {\n    return key;\n  }\n\n  private _getStyleElement(): HTMLStyleElement | undefined {\n    if (!this._styleElement) {\n      this._styleElement = this._createStyleElement();\n\n      if (!REUSE_STYLE_NODE) {\n        // Reset the style element on the next frame.\n        const win = this._config.window || window;\n        win.requestAnimationFrame(() => {\n          this._styleElement = undefined;\n        });\n      }\n    }\n    return this._styleElement;\n  }\n\n  private _findPlaceholderStyleTag(): Element | null {\n    const head: HTMLHeadElement = document.head;\n    if (head) {\n      return head.querySelector('style[data-merge-styles]');\n    }\n    return null;\n  }\n}\n"]}